<!DOCTYPE html>
<html>
    <head>
        <title>MBTA Station Traffic</title>
        <script src="http://d3js.org/d3.v3.min.js"></script>
    </head>
    <body>
        <h1>Hourly Entry and Exit Data</h1>

        <script type="text/javascript" src="/Users/ashleycuster/Desktop/mbta_viz/allfeb_hourly.js"></script>
        <script>

        var pi = Math.PI;

        // var traffic_data = trafficData;

        var stationMap = {"Alewife": {"y_axis": 352, "x_axis": 987, "color": "red"},
                            "Davis Square": {"y_axis": 448, "x_axis": 1078, "color": "red"},
                            "Porter Square": {"y_axis": 538, "x_axis": 1173, "color": "red"},
                            "Harvard": {"y_axis": 632, "x_axis": 1265, "color": "red"},
                            "Central Square": {"y_axis": 727, "x_axis": 1359, "color": "red"},
                            "Kendall Square": {"y_axis": 817, "x_axis": 1450, "color": "red"},
                            "Charles MGH": {"y_axis": 931, "x_axis": 1565, "color": "red"},
                            "Park Street": {"y_axis": 1006, "x_axis": 1637, "color": "red"},
                            "Downtown Crossing": {"y_axis": 1115, "x_axis": 1748, "color": "red"},
                            "South Station": {"y_axis": 1197, "x_axis": 1828, "color": "red"},
                            "Broadway": {"y_axis": 1394, "x_axis": 1929, "color": "red"},
                            "Andrew Square": {"y_axis": 1513, "x_axis": 1930, "color": "red"},
                            "JFK/U Mass": {"y_axis": 1627, "x_axis": 1928, "color": "red"},
                            "Savin Hill": {"y_axis": 1713, "x_axis": 1824, "color": "red"},
                            "Fields Corner": {"y_axis": 1795, "x_axis": 1824, "color": "red"},
                            "Shawmut": {"y_axis": 1875, "x_axis": 1824, "color": "red"},
                            "Ashmont": {"y_axis": 1955, "x_axis": 1824, "color": "red"},
                            "North Quincy": {"y_axis": 1766, "x_axis": 2103, "color": "red"},
                            "Wollaston": {"y_axis": 1837, "x_axis": 2175, "color": "red"},
                            "Quincy Center": {"y_axis": 1911, "x_axis": 2248, "color": "red"},
                            "Quincy Adams": {"y_axis": 1987, "x_axis": 2300, "color": "red"},
                            "Braintree": {"y_axis": 2097, "x_axis": 2300, "color": "red"},
                            "Bowdoin": {"y_axis": 846, "x_axis": 1643, "color": "blue"},
                            "Government Center": {"y_axis": 922, "x_axis": 1717, "color": "blue"},
                            "State Street": {"y_axis": 991, "x_axis": 1800, "color": "blue"},
                            "Aquarium": {"y_axis": 903, "x_axis": 1901, "color": "blue"},
                            "Maverick": {"y_axis": 754, "x_axis": 2053, "color": "blue"},
                            "Airport": {"y_axis": 698, "x_axis": 2106, "color": "blue"},
                            "Wood Island": {"y_axis": 642, "x_axis": 2163, "color": "blue"},
                            "Orient Heights": {"y_axis": 572, "x_axis": 2234, "color": "blue"},
                            "Suffolk Downs": {"y_axis": 501, "x_axis": 2304, "color": "blue"},
                            "Beachmont": {"y_axis": 432, "x_axis": 2373, "color": "blue"},
                            "Revere Beach": {"y_axis": 364, "x_axis": 2441, "color": "blue"},
                            "Wonderland": {"y_axis": 280, "x_axis": 2525, "color": "blue"},
                            "Oak Grove": {"y_axis": 178, "x_axis": 1800, "color": "orange"},
                            "Malden Center": {"y_axis": 252, "x_axis": 1800, "color": "orange"},
                            "Wellington": {"y_axis": 321, "x_axis": 1800, "color": "orange"},
                            "Sullivan Square": {"y_axis": 466, "x_axis": 1800, "color": "orange"},
                            "Community College": {"y_axis": 536, "x_axis": 1800, "color": "orange"},
                            "North Station": {"y_axis": 710, "x_axis": 1800, "color": "orange"},
                            "Haymarket": {"y_axis": 842, "x_axis": 1800, "color": "orange"},
                            "State Street": {"y_axis": 991, "x_axis": 1800, "color": "orange"},
                            "Downtown Crossing": {"y_axis": 1114, "x_axis": 1748, "color": "orange"},
                            "Chinatown": {"y_axis": 1198, "x_axis": 1662, "color": "orange"},
                            "Tufts Medical Center": {"y_axis": 1346, "x_axis": 1516, "color": "orange"},
                            "Back Bay": {"y_axis": 1415, "x_axis": 1445, "color": "orange"},
                            "Mass Ave": {"y_axis": 1478, "x_axis": 1383, "color": "orange"},
                            "Ruggles": {"y_axis": 1545, "x_axis": 1315, "color": "orange"},
                            "Roxbury Crossing": {"y_axis": 1611, "x_axis": 1249, "color": "orange"},
                            "Jackson Square": {"y_axis": 1695, "x_axis": 1166, "color": "orange"},
                            "Stony Brook": {"y_axis": 1779, "x_axis": 1082, "color": "orange"},
                            "Green Street": {"y_axis": 1863, "x_axis": 999, "color": "orange"},
                            "Forest Hills": {"y_axis": 1948, "x_axis": 914, "color": "orange"},
                            "Courthouse": {"y_axis": 1197, "x_axis": 1961, "color": "silver"},
                            "World Trade Center": {"y_axis": 1197, "x_axis": 2004, "color": "silver"}
                        };

        var dateMap = [2014020103, 2014020104, 2014020105, 2014020106, 2014020107,
                        2014020108, 2014020109, 2014020110, 2014020111, 2014020112,
                        2014020113, 2014020114, 2014020115, 2014020116, 2014020117,
                        2014020118, 2014020119, 2014020120, 2014020121, 2014020122,
                        2014020123, 2014020200, 2014020201, 2014020205, 2014020206,
                        2014020207, 2014020208, 2014020209, 2014020210, 2014020211,
                        2014020212, 2014020213, 2014020214, 2014020215, 2014020216,
                        2014020217, 2014020218, 2014020219, 2014020220, 2014020221,
                        2014020222, 2014020223, 2014020300, 2014020301, 2014020304,
                        2014020305, 2014020306, 2014020307, 2014020308, 2014020309,
                        2014020310, 2014020311, 2014020312, 2014020313, 2014020314,
                        2014020315, 2014020316, 2014020317, 2014020318, 2014020319,
                        2014020320, 2014020321, 2014020322, 2014020323, 2014020400,
                        2014020401, 2014020403, 2014020405, 2014020406, 2014020407,
                        2014020408, 2014020409, 2014020410, 2014020411, 2014020412,
                        2014020413, 2014020414, 2014020415, 2014020416, 2014020417,
                        2014020418, 2014020419, 2014020420, 2014020421, 2014020422,
                        2014020423, 2014020500, 2014020501, 2014020502, 2014020503,
                        2014020505, 2014020506, 2014020507, 2014020508, 2014020509,
                        2014020510, 2014020511, 2014020512, 2014020513, 2014020514,
                        2014020515, 2014020516, 2014020517, 2014020518, 2014020519,
                        2014020520, 2014020521, 2014020522, 2014020523, 2014020600,
                        2014020601, 2014020604, 2014020605, 2014020606, 2014020607,
                        2014020608, 2014020609, 2014020610, 2014020611, 2014020612,
                        2014020613, 2014020614, 2014020615, 2014020616, 2014020617,
                        2014020618, 2014020619, 2014020620, 2014020621, 2014020622,
                        2014020623, 2014020700, 2014020701, 2014020703, 2014020704,
                        2014020705, 2014020706, 2014020707, 2014020708, 2014020709,
                        2014020710, 2014020711, 2014020712, 2014020713, 2014020714,
                        2014020715, 2014020716, 2014020717, 2014020718, 2014020719,
                        2014020720, 2014020721, 2014020722, 2014020723, 2014020800,
                        2014020801, 2014020803, 2014020805, 2014020806, 2014020807,
                        2014020808, 2014020809, 2014020810, 2014020811, 2014020812,
                        2014020813, 2014020814, 2014020815, 2014020816, 2014020817,
                        2014020818, 2014020819, 2014020820, 2014020821, 2014020822,
                        2014020823, 2014020900, 2014020901, 2014020905, 2014020906,
                        2014020907, 2014020908, 2014020909, 2014020910, 2014020911,
                        2014020912, 2014020913, 2014020914, 2014020915, 2014020916,
                        2014020917, 2014020918, 2014020919, 2014020920, 2014020921,
                        2014020922, 2014020923, 2014021000, 2014021001, 2014021003,
                        2014021004, 2014021005, 2014021006, 2014021007, 2014021008,
                        2014021009, 2014021010, 2014021011, 2014021012, 2014021013,
                        2014021014, 2014021015, 2014021016, 2014021017, 2014021018,
                        2014021019, 2014021020, 2014021021, 2014021022, 2014021023,
                        2014021100, 2014021101, 2014021103, 2014021104, 2014021105,
                        2014021106, 2014021107, 2014021108, 2014021109, 2014021110,
                        2014021111, 2014021112, 2014021113, 2014021114, 2014021115,
                        2014021116, 2014021117, 2014021118, 2014021119, 2014021120,
                        2014021121, 2014021122, 2014021123, 2014021200, 2014021201,
                        2014021204, 2014021205, 2014021206, 2014021207, 2014021208,
                        2014021209, 2014021210, 2014021211, 2014021212, 2014021213,
                        2014021214, 2014021215, 2014021216, 2014021217, 2014021218,
                        2014021219, 2014021220, 2014021221, 2014021222, 2014021223,
                        2014021300, 2014021301, 2014021302, 2014021304, 2014021305,
                        2014021306, 2014021307, 2014021308, 2014021309, 2014021310,
                        2014021311, 2014021312, 2014021313, 2014021314, 2014021315,
                        2014021316, 2014021317, 2014021318, 2014021319, 2014021320,
                        2014021321, 2014021322, 2014021323, 2014021400, 2014021401,
                        2014021402, 2014021403, 2014021404, 2014021405, 2014021406,
                        2014021407, 2014021408, 2014021409, 2014021410, 2014021411,
                        2014021412, 2014021413, 2014021414, 2014021415, 2014021416,
                        2014021417, 2014021418, 2014021419, 2014021420, 2014021421,
                        2014021422, 2014021423, 2014021500, 2014021501, 2014021505,
                        2014021506, 2014021507, 2014021508, 2014021509, 2014021510,
                        2014021511, 2014021512, 2014021513, 2014021514, 2014021515,
                        2014021516, 2014021517, 2014021518, 2014021519, 2014021520,
                        2014021521, 2014021522, 2014021523, 2014021600, 2014021601,
                        2014021605, 2014021606, 2014021607, 2014021608, 2014021609,
                        2014021610, 2014021611, 2014021612, 2014021613, 2014021614,
                        2014021615, 2014021616, 2014021617, 2014021618, 2014021619,
                        2014021620, 2014021621, 2014021622, 2014021623, 2014021700,
                        2014021701, 2014021705, 2014021706, 2014021707, 2014021708,
                        2014021709, 2014021710, 2014021711, 2014021712, 2014021713,
                        2014021714, 2014021715, 2014021716, 2014021717, 2014021718,
                        2014021719, 2014021720, 2014021721, 2014021722, 2014021723,
                        2014021800, 2014021801, 2014021804, 2014021805, 2014021806,
                        2014021807, 2014021808, 2014021809, 2014021810, 2014021811,
                        2014021812, 2014021813, 2014021814, 2014021815, 2014021816,
                        2014021817, 2014021818, 2014021819, 2014021820, 2014021821, 2014021822, 2014021823, 2014021900, 2014021901, 2014021902, 2014021905, 2014021906, 2014021907, 2014021908, 2014021909, 2014021910, 2014021911, 2014021912, 2014021913, 2014021914, 2014021915, 2014021916, 2014021917, 2014021918, 2014021919, 2014021920, 2014021921, 2014021922, 2014021923, 2014022000, 2014022001, 2014022004, 2014022005, 2014022006, 2014022007, 2014022008, 2014022009, 2014022010, 2014022011, 2014022012, 2014022013, 2014022014, 2014022015, 2014022016, 2014022017, 2014022018, 2014022019, 2014022020, 2014022021,
                        2014022022, 2014022023, 2014022100, 2014022101, 2014022103, 2014022104, 2014022105, 2014022106, 2014022107, 2014022108, 2014022109, 2014022110, 2014022111, 2014022112, 2014022113, 2014022114, 2014022115, 2014022116, 2014022117, 2014022118, 2014022119, 2014022120, 2014022121, 2014022122, 2014022123, 2014022200, 2014022201, 2014022205, 2014022206, 2014022207, 2014022208, 2014022209, 2014022210, 2014022211, 2014022212, 2014022213, 2014022214, 2014022215, 2014022216, 2014022217, 2014022218, 2014022219, 2014022220, 2014022221, 2014022222, 2014022223, 2014022300, 2014022301, 2014022305,
                        2014022306, 2014022307, 2014022308, 2014022309, 2014022310, 2014022311, 2014022312, 2014022313, 2014022314, 2014022315, 2014022316, 2014022317, 2014022318, 2014022319, 2014022320, 2014022321, 2014022322, 2014022323, 2014022400, 2014022401, 2014022404, 2014022405, 2014022406, 2014022407, 2014022408, 2014022409, 2014022410, 2014022411, 2014022412, 2014022413, 2014022414, 2014022415, 2014022416, 2014022417, 2014022418, 2014022419, 2014022420, 2014022421, 2014022422, 2014022423, 2014022500, 2014022501, 2014022504, 2014022505, 2014022506, 2014022507, 2014022508, 2014022509, 2014022510,
                        2014022511, 2014022512, 2014022513, 2014022514, 2014022515, 2014022516, 2014022517, 2014022518, 2014022519, 2014022520, 2014022521, 2014022522, 2014022523, 2014022600, 2014022601, 2014022602, 2014022603, 2014022605, 2014022606, 2014022607, 2014022608, 2014022609, 2014022610, 2014022611, 2014022612, 2014022613, 2014022614, 2014022615, 2014022616, 2014022617, 2014022618, 2014022619, 2014022620, 2014022621, 2014022622, 2014022623, 2014022700, 2014022701, 2014022706, 2014022707, 2014022708, 2014022709, 2014022710, 2014022711, 2014022712, 2014022713, 2014022714, 2014022715, 2014022716,
                        2014022717, 2014022718, 2014022719, 2014022720, 2014022721, 2014022722, 2014022723, 2014022800, 2014022801, 2014022802, 2014022804, 2014022805, 2014022806, 2014022807, 2014022808, 2014022809, 2014022810, 2014022811, 2014022812, 2014022813, 2014022814, 2014022815, 2014022816, 2014022817, 2014022818, 2014022819, 2014022820, 2014022821, 2014022822, 2014022823, 2014030100, 2014030101, 2014030102, 2014030105, 2014030106, 2014030107, 2014030108, 2014030109, 2014030110, 2014030111, 2014030112, 2014030113, 2014030114, 2014030115, 2014030116, 2014030117, 2014030118, 2014030119, 2014030120,
                        2014030121, 2014030122, 2014030123, 2014030200, 2014030201, 2014030203, 2014030205, 2014030206, 2014030207, 2014030208, 2014030209, 2014030210, 2014030211, 2014030212, 2014030213, 2014030214, 2014030215, 2014030216, 2014030217, 2014030218, 2014030219, 2014030220, 2014030221, 2014030222, 2014030223, 2014030300, 2014030301];


        var svgContainer = d3.select("body").append("svg")
                                            .attr("width", 3000)
                                            .attr("height", 3000);

        var label = svgContainer.append("text")
                        .attr("class", "date label")
                        .attr("text-anchor", "end")
                        .attr("y", 1500)
                        .attr("x", 0)
                        .text("February 1 08:00");

        // var bisect = d3.bisector(function(d) {return d[0];});

        var arcPath = d3.svg.arc()
                                .innerRadius(2)
                                .outerRadius(function (d) {return (d.num_people)/25;})
                                .startAngle(function (d) {if (d.direction === 'entry') {return pi;} else {return 0;}})
                                .endAngle(function (d) {if (d.direction === 'entry') {return 2*pi;} else {return pi;}});

        // instead of appending path elements we append g each one moved to the x/y offset
        var arcGroups = svgContainer.selectAll("path")
                                    .data(getData(1))
                                    .enter()
                                    .append("g")
                                    .attr("transform", function (d) {var station_in = d.station;
                                                                        if (station_in in stationMap)
                                                                            {var x_axis = stationMap[station_in]['x_axis'];
                                                                            var y_axis = stationMap[station_in]['y_axis'];
                                                                            return "translate(" + x_axis + "," + y_axis + ")";}
                                                                        else {console.log(station_in)}
                                                                    })
                                    .attr("id", "arcID");


        // and to each group we append the left & right arc
        arcGroups.append("path")
                .attr("d", arcPath)
                .attr("fill",
                        function (d) {if (d.station in stationMap)
                                        {return stationMap[d.station]['color']}
                                    else
                                        {return 'white'}});

        // show station names with mouseover
        arcGroups.append("svg:title").text(function (d) { return d.station; });


        svgContainer.transition()
                    .duration(30000)
                    .ease("linear")
                    .tween("date", tweenDate);



        // functions!

        function getData(date) {
            return traffic_data.map(function(d) {
                return {
                    station: d.station,
                    direction: d.direction,
                    num_people: getPeople(d.num_people, date)
                };
            });
        }

        function getPeople(values, date) {
            // var i = bisect.left(values, date, 0, values.length - 1),
            //     a = values[i];
            // return a[1];
            var index = Math.round(date);
                a = values[index];
            console.log(a);
            console.log(index);
            return a[1];
        }

        function tweenDate() {
            var upper_bound = dateMap.length - 1;
            var date = d3.interpolateNumber(1, upper_bound);
            return function (t) { displayDate(date(t)); };
        }

        function displayDate(date) {
            // add something to remove previous elements
            arcGroups.selectAll("path").remove();

            arcGroups.data(getData(date))
                        .append("path").attr("d", arcPath)
                        .attr("fill", function (d) {if (d.station in stationMap) {return stationMap[d.station]['color']} else {return 'white'}});


        }

        </script>
    </body>
</html>
